<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>Untangled Developer&#8217;s Reference</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Untangled Developer&#8217;s Reference</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_basic_ui">Basic UI</a>
<ul class="sectlevel2">
<li><a href="#_creating_a_custom_react_class">Creating a Custom React Class</a></li>
<li><a href="#_react_lifecycle_methods">React lifecycle methods</a></li>
<li><a href="#_clojurescript_and_react_html_differences">ClojureScript and React – HTML differences</a></li>
<li><a href="#_element_factory">Element factory</a></li>
<li><a href="#_rendering_a_component_sending_and_accessing_properties">Rendering a Component, Sending, and Accessing Properties</a></li>
<li><a href="#_computed_data_like_callbacks">Computed data like Callbacks</a></li>
<li><a href="#_stateful_components">Stateful components</a></li>
<li><a href="#_built_in_react_dom">Built-in React DOM</a></li>
</ul>
</li>
<li><a href="#_application_database_format">Application Database Format</a>
<ul class="sectlevel2">
<li><a href="#_tables">Tables</a></li>
<li><a href="#_idents">Idents</a></li>
<li><a href="#_graph">Graph</a></li>
</ul>
</li>
<li><a href="#_the_query_language">The Query Language</a>
<ul class="sectlevel2">
<li><a href="#_attributes">Attributes</a></li>
<li><a href="#_joins">Joins</a></li>
<li><a href="#_recursion">Recursion</a></li>
<li><a href="#_unions">Unions</a></li>
<li><a href="#_query_parameters">Query parameters</a></li>
</ul>
</li>
<li><a href="#_initial_application_state">Initial Application State</a>
<ul class="sectlevel2">
<li><a href="#_using_initialappstate">Using InitialAppState</a></li>
<li><a href="#_using_a_manually_constructed_graph_db">Using a manually-constructed graph db</a></li>
<li><a href="#_using_a_manually_constructed_tree">Using a manually-constructed tree</a></li>
</ul>
</li>
<li><a href="#_mutations">Mutations</a>
<ul class="sectlevel2">
<li><a href="#_built_in_mutations">Built-in mutations</a></li>
<li><a href="#_custom_mutations">Custom mutations</a></li>
<li><a href="#_invoking_a_mutation_code_transact_code">Invoking a mutation (<code>transact!</code>)</a></li>
<li><a href="#_post_mutation_hooks_experimental">Post mutation hooks (experimental)</a></li>
<li><a href="#_ui_refresh_after_mutation">UI refresh after mutation</a></li>
</ul>
</li>
<li><a href="#_untangled_server_and_full_stack_integration">Untangled Server and Full Stack Integration</a>
<ul class="sectlevel2">
<li><a href="#_overall_network_plumbing">Overall Network Plumbing</a></li>
<li><a href="#_implementing_server_queries">Implementing server queries</a></li>
<li><a href="#_initial_data_loading">Initial Data Loading</a></li>
<li><a href="#_on_demand_loading">On-demand Loading</a></li>
<li><a href="#_implementing_server_mutations">Implementing server mutations</a></li>
<li><a href="#_server_reads_after_mutation">Server reads (after mutation)</a></li>
<li><a href="#_out_of_band_data_websocket_timeout_xhr">Out-of-band Data (websocket, timeout, XHR)</a></li>
<li><a href="#_handling_network_errors">Handling network errors</a></li>
</ul>
</li>
<li><a href="#_untangled_spec">Untangled Spec</a>
<ul class="sectlevel2">
<li><a href="#_specification_layout">Specification Layout</a></li>
<li><a href="#_assertions_and_arrows">Assertions and arrows</a></li>
<li><a href="#_mocking">Mocking</a></li>
</ul>
</li>
<li><a href="#_untangled_datomic">Untangled Datomic</a>
<ul class="sectlevel2">
<li><a href="#_injecting_and_configuring_database_s">Injecting and configuring database(s)</a></li>
<li><a href="#_schema_support">Schema support</a></li>
<li><a href="#_migrations">Migrations</a></li>
<li><a href="#_validated_transactions_experimental">Validated transactions (EXPERIMENTAL)</a></li>
</ul>
</li>
<li><a href="#_websockets">Websockets</a></li>
<li><a href="#_internationalization">Internationalization</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This reference guide is meant to be an indexed document for quickly finding information about the Untangled Web
Framework. If you&#8217;re trying to learn Untangled, then you should do the
<a href="https://github.com/untangled-web/untangled-tutorial">tutorial</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_ui">Basic UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Untangled uses Om, which in turn uses <a href="https://facebook.github.io/react/index.html" target="_blank">React</a> underneath.</p>
</div>
<div class="sect2">
<h3 id="_creating_a_custom_react_class">Creating a Custom React Class</h3>
<div class="paragraph">
<p>The mechanism for creating components is the <code>defui</code> macro:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(defui ComponentClassName
  Object
  (componentWillUpdate [this nextprops nextstate] (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Component will update</span><span class="delimiter">&quot;</span></span>))
  (render [this]
    (dom/div <span class="predefined-constant">nil</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world</span><span class="delimiter">&quot;</span></span>)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>This macro generates a React class as a plain JavaScript class, so it is completely compatible with the
React ecosystem.</p>
</div>
<div class="paragraph">
<p>Notice the use of <code>Object</code>. It indicates that the following method bodies (like in
<a href="http://clojure.org/reference/protocols" target="_blank">protocols</a>) are being added to the
generated class. From an OO perspective, this is like saying \"my widget extends Object\". The <code>render</code>
method is the only method you need, but you can also add in your own methods or React lifecycle
methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_react_lifecycle_methods">React lifecycle methods</h3>
<div class="paragraph">
<p>If you wish to provide
<a href="https://facebook.github.io/react/docs/component-specs.html#lifecycle-methods" target="_blank">lifecycle methods</a>, you can
define them under the Object section of the UI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(defui WidgetWithHook
  Object
  (componentWillUpdate [this nextprops nextstate] (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Component will update</span><span class="delimiter">&quot;</span></span>))
  (render [this]
    (dom/div <span class="predefined-constant">nil</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world</span><span class="delimiter">&quot;</span></span>)))</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_lifecycle_method_signatures">Lifecycle method signatures</h4>
<div class="paragraph">
<p>For reference these are the signatures you should use for the React Lifecycle methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(initLocalState [this])
(componentWillReceiveProps [this next-props])
(componentWillUpdate [this next-props next-state])
(componentDidUpdate [this prev-props prev-state])
(componentWillMount [this])
(componentDidMount [this])
(componentWillUnmount [this])</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clojurescript_and_react_html_differences">ClojureScript and React – HTML differences</h3>
<div class="paragraph">
<p>Here are some common things you&#8217;ll want to know how to do that are different when rendering with Om/ClojureScript:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inline styles are specified with real maps <code>(dom/p #js { :style #js {:backgroundColor \"rgb(120,33,41)\"} } &#8230;&#8203;)</code>.
Note the nested use of raw Javascript maps. These are passed directly to React. Using cljs persistent data structures
won&#8217;t work.</p>
</li>
<li>
<p>CSS class names are specified with <code>:className</code> instead of <code>:class</code>.</p>
</li>
<li>
<p>Any time there are adjacent elements of the same type in the DOM, they should each have a unique <code>:key</code>
attribute. This is typically generated by a function you supply to the Om factory function, but you can
also do it manually.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_element_factory">Element factory</h3>
<div class="paragraph">
<p>In order to render components on the screen you need an element factory.
You generate a factory with <code>om/factory</code>, which will then
act like a new 'tag' for your DOM. We commonly prefix these factories with <code>ui-</code> so
we don&#8217;t confuse them with query attribute names and other local bindings. If the
component is ever to be rendered in a list of adjacent elements then the factory should
be given a key function for generating unique React keys on the component.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">def</span> <span class="function">ui-widget</span> (om/factory Widget {<span class="symbol">:keyfn</span> (<span class="keyword">fn</span> [props] (<span class="keyword">get</span> props <span class="symbol">:some-prop</span>))}))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rendering_a_component_sending_and_accessing_properties">Rendering a Component, Sending, and Accessing Properties</h3>
<div class="paragraph">
<p>You can now render a widget inside of any other component using <code>(ui-widget { :prop 1 })</code>.</p>
</div>
<div class="paragraph">
<p>You access properties in a component using <code>om/props</code>:"</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(defui Widget
  Object
  (render [this]
    (<span class="keyword">let</span> [{<span class="symbol">:keys</span> [<span class="keyword">name</span>]} (om/props this)]
      (dom/div <span class="predefined-constant">nil</span> (<span class="keyword">str</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> <span class="keyword">name</span>)))))

(<span class="keyword">def</span> <span class="function">ui-widget</span> (om/factory Widget))

<span class="keyword">..</span><span class="keyword">.</span>
   (ui-widget {<span class="symbol">:name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Sally</span><span class="delimiter">&quot;</span></span>})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_computed_data_like_callbacks">Computed data like Callbacks</h3>
<div class="paragraph">
<p>In plain React you store component local state and pass data from the parent to the child through props.
You also pass your callbacks through props. In Untangled, we need a slight variation of
this because a component can have a query that asks the underlying system for data.</p>
</div>
<div class="paragraph">
<p>If you complect callbacks and such with this queried data then you run into trouble because the rendering system
can re-render a component without going through the parent, meaning that callbacks could be lost.</p>
</div>
<div class="paragraph">
<p>So, in general <strong>props are for passing data that the component requested from a query</strong>.</p>
</div>
<div class="paragraph">
<p>As such, Om has an additional mechanism for passing things that were not specifically asked for in a query: Computed
properties.</p>
</div>
<div class="paragraph">
<p>For your Om UI to function properly you must attach computed properties to props via the helper function <code>om/computed</code>.
The child can look for these computed properties using <code>om/get-computed</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stateful_components">Stateful components</h3>
<div class="paragraph">
<p>Earlier we stress that your components should be stateless whenever possible. There are a few
notable exceptions that we have found useful (or even necessary):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Untangled support viewer shows each app state change. User input (each letter they type) can
be quite tedious to watch in a support viewer. Moving these kinds of interstitial form interactions
into local component state causes little harm, and greatly enhances support. Om automatically hooks up local
state to input fields when you use "uncontrolled" form elements (which means you didn&#8217;t set value/checked).</p>
</li>
<li>
<p>External library integration. We use stateful components like D3 visualizations.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_form_inputs">Form inputs</h4>
<div class="paragraph">
<p>Om already hooks local state to form elements. So, in fact, you have to override this to <strong>not</strong> use
component local state. For text controls we&#8217;d recommend you leave it this way. For other controls like
checkboxes it is probably best to override this.</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_library_state">External library state</h4>
<div class="paragraph">
<p>See the D3 example in the Untangled Tutorial.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_built_in_react_dom">Built-in React DOM</h3>
<div class="paragraph">
<p>All of the standard HTML tags have pre-built React components, accessible from the <code>om.dom</code> namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">ui</span>
  (<span class="symbol">:require</span> [om.dom <span class="symbol">:as</span> dom]))

(defui Widget
  Object
  (render [this]
    (dom/div <span class="predefined-constant">nil</span> (<span class="keyword">str</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> <span class="keyword">name</span>))))</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_database_format">Application Database Format</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Untangled applications use the default Om database format. This is a simple graph database format made from
standard Clojurescript persistent data structures: Maps and vectors. The entire database is a map.</p>
</div>
<div class="sect2">
<h3 id="_tables">Tables</h3>
<div class="paragraph">
<p>Specific items in the database are stored in tables. Each table is indexed by a top-level key in the database.
Items in the database can refer to other items via a foreign reference, which is formatted as an Ident. It is also legal
to have top-level data that is not a table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:value</span> <span class="integer">53</span>
 <span class="symbol">:table/by-id</span> { <span class="integer">1</span> { <span class="symbol">:id</span> <span class="integer">1</span> <span class="symbol">:x</span> <span class="integer">1</span> } } }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only way to tell a table from a value is by convention. Tables will usually be named in a way that
indicates what the primary key of the table is (e.g. <code>by-id</code>), and will be maps of maps. Regular values can
be anything, including an Ident.</p>
</div>
</div>
<div class="sect2">
<h3 id="_idents">Idents</h3>
<div class="paragraph">
<p>An Ident is nothing more than a two element vector, where the first entry is a keyword (the "name" of a database table)
and the second entry is the ID of the object in that table: <code>[:table-name id]</code></p>
</div>
<div class="paragraph">
<p>In the database above you would describe the object in the table as <code>[:table/by-id 1]</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_graph">Graph</h3>
<div class="paragraph">
<p>Combining regular values, tables, and idents gives you the overall database format which can support any arbitrary
graph. The database below has a list of two people (via idents pointing to the people in the table), and each
person has a pointer to the person that is their mate. This creates a graph with a loop (when following mate).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:my-list</span> [ [<span class="symbol">:people/by-id</span> <span class="integer">1</span>] [<span class="symbol">:people/by-id</span> <span class="integer">2</span>] ]
 <span class="symbol">:people/by-id</span> {
   <span class="integer">1</span> { <span class="symbol">:db/id</span> <span class="integer">1</span> <span class="symbol">:person/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Tony</span><span class="delimiter">&quot;</span></span> <span class="symbol">:person/mate</span> [<span class="symbol">:people/by-id</span> <span class="integer">2</span>]}
   <span class="integer">2</span> { <span class="symbol">:db/id</span> <span class="integer">2</span> <span class="symbol">:person/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Jill</span><span class="delimiter">&quot;</span></span> <span class="symbol">:person/mate</span> [<span class="symbol">:people/by-id</span> <span class="integer">1</span>]}}}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="basic-db.png" alt="basic db" width="690" height="210">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_query_language">The Query Language</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The query language is a subset of Datomic Pull syntax. It is a syntax that is designed to walk a graph and produce a
tree (which is suitable for a UI, which is naturally a tree).</p>
</div>
<div class="paragraph">
<p>Queries are written as a vector.</p>
</div>
<div class="sect2">
<h3 id="_attributes">Attributes</h3>
<div class="paragraph">
<p>The query <code>[:a :b :c]</code> means read the attributes <code>:a</code> <code>:b</code>, and <code>:c</code> from the current object. For example,
if this query was against the root of the graph, it would mean the top-level database itself should contain the
keys <code>:a</code>, <code>:b</code>, and <code>:c</code>. In the context of a join (or sequence of joins) it indicates attribute reads in that
context.</p>
</div>
<div class="paragraph">
<p>One may query any attribute that makes sense, including an entire table. For example, the query <code>[:people/by-id]</code>
against the database above will return:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{ <span class="symbol">:people/by-id</span> { <span class="integer">1</span> { <span class="symbol">:db/id</span> <span class="integer">1</span> <span class="symbol">:person/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Tony</span><span class="delimiter">&quot;</span></span> <span class="symbol">:person/mate</span> [<span class="symbol">:people/by-id</span> <span class="integer">2</span>]}
                  <span class="integer">2</span> { <span class="symbol">:db/id</span> <span class="integer">2</span> <span class="symbol">:person/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Jill</span><span class="delimiter">&quot;</span></span> <span class="symbol">:person/mate</span> [<span class="symbol">:people/by-id</span> <span class="integer">1</span>]}}}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_joins">Joins</h3>
<div class="paragraph">
<p>Joins can be done against reference typed attributes (which essentially means an attribute holding an ident).</p>
</div>
<div class="paragraph">
<p>Joins are written as a map, where the key is the join point, and the value is a sub-query: <code>[{:my-list [:person/name]}]</code>. If
the join point is a vector of idents, then it is a to-many join and the query will result in multiple values. If
the join point is a single ident, then it is a to-one join, and the query will result in a single value. In the
context of our database above this query should return the names of the people in my list.</p>
</div>
<div class="paragraph">
<p>The join shown in the prior paragraph against our database above would result in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{ <span class="symbol">:my-list</span> [ {<span class="symbol">:person/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Tony</span><span class="delimiter">&quot;</span></span>} {<span class="symbol">:person/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Jill</span><span class="delimiter">&quot;</span></span>} ] }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_recursion">Recursion</h3>
<div class="paragraph">
<p>Queries can be recursive. In the case where the graph has a normal termination point (such as bullet lists) you
can use <code>&#8230;&#8203;</code> to indicate a recursive join: <code>[{:list [:item/name {:sublist &#8230;&#8203;}]}]</code></p>
</div>
<div class="paragraph">
<p>This would return a nested map that would follow the graph database links and possibly return something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{ <span class="symbol">:list</span> { <span class="symbol">:item/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">A</span><span class="delimiter">&quot;</span></span>
          <span class="symbol">:sublist</span> [ { <span class="symbol">:item/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">A.1</span><span class="delimiter">&quot;</span></span> }
                     { <span class="symbol">:item/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">A.1</span><span class="delimiter">&quot;</span></span> <span class="symbol">:sublist</span> [ { <span class="symbol">:item/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">A.1.1</span><span class="delimiter">&quot;</span></span> } ]}]}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In our database from earlier, we have a loop. The query engine will automatically detect loops and stop, but you can manually
limit the recusion depth using a number instead of <code>&#8230;&#8203;</code>: <code>[{:my-list [:person/name {:person/mate 1}]}]</code>
which would result in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{ <span class="symbol">:my-list</span> [ { <span class="symbol">:person/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Tony</span><span class="delimiter">&quot;</span></span> <span class="symbol">:person/mate</span> { <span class="symbol">:person/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Jill</span><span class="delimiter">&quot;</span></span> } }
             { <span class="symbol">:person/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Jill</span><span class="delimiter">&quot;</span></span> <span class="symbol">:person/mate</span> { <span class="symbol">:person/name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Tony</span><span class="delimiter">&quot;</span></span> } } ]}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_unions">Unions</h3>
<div class="paragraph">
<p>Union queries are used strictly as the subquery on joins, and are represented by a map. The keys of the map represent
the possible choices of subquery to run, and the value represents the subquery.</p>
</div>
<div class="paragraph">
<p>In the case of a union query one must realize that it is impossible to say what the query means until you look at the
actual database. Here is how they work:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Examine the Ident at the join point of the join. Extract the keyword from that ident.</p>
</li>
<li>
<p>Use the ident from (1) to look up the subquery from the union.</p>
</li>
<li>
<p>Continue processing the query using that subquery</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_union_example">Union Example</h4>
<div class="paragraph">
<p>Assume the following simple database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{ <span class="symbol">:things</span> [ [<span class="symbol">:people/by-id</span> <span class="integer">1</span>] [<span class="symbol">:animals/by-id</span> <span class="integer">1</span>] ]
  <span class="symbol">:people/by-id</span> { <span class="integer">1</span> { <span class="symbol">:id</span> <span class="integer">1</span> <span class="symbol">:type</span> <span class="symbol">:person</span> <span class="symbol">:name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span> } }
  <span class="symbol">:animals/by-id</span> { <span class="integer">1</span> { <span class="symbol">:id</span> <span class="integer">1</span> <span class="symbol">:type</span> <span class="symbol">:dog</span> <span class="symbol">:breed</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Poodle</span><span class="delimiter">&quot;</span></span> } } }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query: <code>[{:things { :people/by-id [:type :name]
                                  :animals/by-id [:type :breed] }}]</code></p>
</div>
<div class="paragraph">
<p>would see the to-many join of <code>:things</code>, and for each element it would select the proper subquery. Resulting in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">[ { <span class="symbol">:type</span> <span class="symbol">:person</span> <span class="symbol">:name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span> }
  { <span class="symbol">:type</span> <span class="symbol">:dog</span> <span class="symbol">:breed</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Poodle</span><span class="delimiter">&quot;</span></span> } ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unions work fine on to-one joins exactly the same (returning only one result).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_query_parameters">Query parameters</h3>
<div class="paragraph">
<p>The query language includes support for adding a parameter map to every kind of query element. Untangled does not
support such parameters on the UI; however, since the same query language is used with respect to the server, it is
useful to know how to represent them.</p>
</div>
<div class="paragraph">
<p>Basically, you surround the query element with parens, and add a map as the second entry.</p>
</div>
<div class="paragraph">
<p>A property with a parameter: <code>[(:prop { :param 1})]</code>
A join with a parameter: <code>[({:prop [:a :b]} { :param 1})]</code></p>
</div>
<div class="paragraph">
<p>Again, the the UI cannot make sense of these, but you can write such queries to the server and interpret them there.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_initial_application_state">Initial Application State</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Building your initial application state can be done in one of three ways. The recommended approach is to co-locate the
application state on the components that will use it. You may also hand-build either a tree (which can be
auto-normalized by the UI components into a graph). Finally, you may hand-build a graph database in the format described
earlier.</p>
</div>
<div class="paragraph">
<p>All three methods should result in a graph database. They are just different approaches at initial input, with different
pros/cons.</p>
</div>
<div class="paragraph">
<p>In all cases you must ensure that the components have Ident implementations that match up with your graph structure.</p>
</div>
<div class="sect2">
<h3 id="_using_initialappstate">Using InitialAppState</h3>
<div class="paragraph">
<p>This is probably the easiest method to code, and the easiest to keep straight during development because the data
is co-located with the queries and UI bits. The only disadvantage is that you cannot easily initialize parts of the
graph that do not have a UI representation (which is probably rare).</p>
</div>
<div class="paragraph">
<p>Implement the <code>InitialAppState</code> protocol on your ui components, and compose the initial state together just like you
do with queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(defui Child
  static uc/InitialAppState
  (initial-state [clz params] { <span class="symbol">:a</span> <span class="integer">1</span> })
  <span class="keyword">..</span><span class="keyword">.</span>)

(defui Parent
  static uc/InitialAppState
  (initial-state [clz params] { <span class="symbol">:x</span> <span class="integer">1</span> <span class="symbol">:child</span> (uc/initial-state Child) })
  <span class="keyword">..</span><span class="keyword">.</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compose these all the way to your root component. Untangled will detect state on your root component, and use that
to construct the initial application database.</p>
</div>
<div class="sect3">
<h4 id="_unions_and_initialappstate">Unions and InitialAppState</h4>
<div class="paragraph">
<p>To-one unions (e.g. used in tabbed interfaces) are automatically resolved if the branches of the union all define
InitialAppState implementations. The union component InitialAppState should define the "default" branch of the union.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_manually_constructed_graph_db">Using a manually-constructed graph db</h3>
<div class="paragraph">
<p>Simply create your database in a map, then <strong>wrap it in an atom</strong> and pass that via the <code>:initial-state</code> parameter of
<code>new-untangled-client</code>. This method is a bit of a hassle to maintain, but allows you to place things in the database
that are not (yet) in your UI.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_manually_constructed_tree">Using a manually-constructed tree</h3>
<div class="paragraph">
<p>Create a tree of data in a map. Pass it (not wrapped in an atom) to <code>:initial-state</code>. This technique is probably the
least useful. It is no more functional than the <code>InitialAppState</code> method, but is harder to maintain.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mutations">Mutations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Untangled uses the abstract top-level transactions modelled by Om to evolve your application state. One should view
mutations as a function that evolves the state of the database:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="mutations.png" alt="mutations" width="390" height="112">
</div>
</div>
<div class="paragraph">
<p>Remember that almost everything in your database should be in a table. Mutations run in the context of components (or
can take parameters), which means that mutations can be given sufficient context (e.g. an ident of the thing to change)
to be fully abstract. An operation like <code>set-date-to-todate</code> might take the ident of a calendar widget. It need only
go to that place in the database and change the state there.</p>
</div>
<div class="sect2">
<h3 id="_built_in_mutations">Built-in mutations</h3>
<div class="paragraph">
<p>The following functions are built in (in <code>untangled.client.mutations</code>), and should generally only be used in the context of UI state changes (e.g.
folding, checkbox toggle, etc.). They invoke an internal transaction.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
You should not use these for bit-twiddling your real state! Define your own top-level abstract transactions.
These functions are really meant as convenience when dealing with controlled form inputs whose state is in your app
state.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>(set-string! component field [event|value])</code></p>
</li>
<li>
<p><code>(set-integer! field [event|value])</code></p>
</li>
<li>
<p><code>(set-value! component field value)</code></p>
</li>
<li>
<p><code>(toggle! component field)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two take a value or event via a named parameter. For example <code>(m/set-string! this :name :event evt)</code> where
<code>evt</code> is a javascript input field event will extra the input&#8217;s value and store it in the app db on the correct table
entry. These functions are really meant for working with form field state stored in the app database (as opposed to
component local state in uncontrolled form inputs).</p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_mutations">Custom mutations</h3>
<div class="paragraph">
<p>Untangled provides a multimethod that you can hook your own mutations into.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">app.mutations</span>
  (<span class="symbol">:require</span> [untangled.client.mutations <span class="symbol">:as</span> m]))

(<span class="keyword">defmethod</span> <span class="function">m/mutate</span> 'my/mutation-symbol [env k params]
   { <span class="symbol">:action</span> (<span class="keyword">fn</span>[] <span class="keyword">..</span><span class="keyword">.</span>) })</code></pre>
</div>
</div>
<div class="paragraph">
<p>The three parameters are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>env</code>: The mutation environment. This is a map that contains:&#8201;&#8212;&#8201;<code>state</code>: The current app database atom. Use <code>swap!</code> to modify it&#8201;&#8212;&#8201;<code>ref</code>: The ident of the component that invoked the transaction</p>
</li>
<li>
<p><code>k</code>: This is the symbol, which is identical to the multimethod dispatch value (generally ignored)</p>
</li>
<li>
<p><code>params</code>: The parameters passed to the mutation</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The body should <strong>not</strong> side-effect! It should instead return a map. The map can contain:
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>:action</code>: A lambda function to run that will actually do the side-effects</p>
</li>
<li>
<p>One or more remote indicators. Typically something like <code>:remote true</code>. See the section on remote mutations.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_invoking_a_mutation_code_transact_code">Invoking a mutation (<code>transact!</code>)</h3>
<div class="paragraph">
<p>The <code>om/transact!</code> function is used to run a top-level transaction, and can invoke any number of mutations (in order).
It must be given a component reference or reconciler (typically the former) and a transaction to run. This looks just
like the query notation, but looks to include method calls (which will invoke the multimetod by symbol):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(om/transact! this '[(my/mutation-symbol {<span class="symbol">:x</span> <span class="integer">1</span>}) (other/mutations)])</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mutations in a transaction will run in order. Any of them that indicate a remote nature will be sent across the
wire to the server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_post_mutation_hooks_experimental">Post mutation hooks (experimental)</h3>
<div class="paragraph">
<p>The is a multimethod for adding in post-mutation handlers that will run after the main mutation. These can be useful
when there is a common behavior that should happen after some set of mutations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ui_refresh_after_mutation">UI refresh after mutation</h3>
<div class="paragraph">
<p>Untangled uses Om to manage the UI, and as such the UI refresh story is Om&#8217;s story. The basic
rule is that when you <code>transact!</code>, the component (subtree) used for the transaction will be refreshed in the UI. This
allows you to automatically handle a lot of UI updates without having to think much; however, there are a couple of
general rules and tools you can use when this alone is insufficient.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Move the transaction to a parent, and pass a callback that invokes (the parent&#8217;s) transaction in the child. This
technique composes well (the parent has to know about the child, but the child need only support the abstract idea
of providing a callback hook). This is the most common technique in list management, where a child might have a delete
button, but the delete really needs to happen on the parent&#8217;s list.</p>
</li>
<li>
<p>Use follow-in reads</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_follow_on_reads">Follow-on Reads</h4>
<div class="paragraph">
<p>The name "follow-on reads" is meant to describe the abstract way of refreshing the UI without thinking specifically
about the UI. A follow-on read is a way to indicate what (typically derived) data should be re-read from your
application database after a mutation. For example, if you have a friend list and you add someone to it, you might
need to re-read the count of friends for some indicator somewhere else on the screen. It is easy to reason about
the concept that the mutation <code>add-friend</code> affects the database value <code>:friend-count</code> (which you can explicitly store
as a denormalized value after each mutation, or derive in the UI by pulling in the list of friends and counting them).</p>
</div>
<div class="paragraph">
<p>Independent of how you store data in your database, you know what you&#8217;ve changed in a mutation. So, when you run
a mutation you can indicate that you&#8217;d like the parts of the UI that <strong>ask</strong> for those other bits of data to refresh.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_untangled_server_and_full_stack_integration">Untangled Server and Full Stack Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Untangled server library provides a full-stack development experience for Untangled Web applications. When combined
with the client library, you get a number of base features that are useful for most applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An easy-to-use pluggable architecture for adding in databases and other components</p>
</li>
<li>
<p>A clear way to add read/write semantics for handling Untangled queries and mutations</p>
</li>
<li>
<p>Processing pipeline hooks for pre-processing, post-processing, and non-API routes (e.g. file serving)</p>
</li>
<li>
<p>General data compression and file resource cache headers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The overall network plumbing of Untangled includes a number of additional features that assist with some
common patterns needed by most applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JSON+Transit for API encoding</p>
</li>
<li>
<p>The ability to elide UI-only bits of query when using a general UI query against a server</p>
</li>
<li>
<p>A clean story for app-state merging that includes attribute "stomping" semantics</p>
</li>
<li>
<p>Clear network communication ordering to prevent out-of-order execution reasoning</p>
</li>
<li>
<p>The ability to send queries in parallel when sequential reads are not necessary for clear reasoning (parallel loading)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_overall_network_plumbing">Overall Network Plumbing</h3>
<div class="paragraph">
<p>There are a number of convenient things that the network stack does automatically, as shown in the
diagram below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="plumbing.png" alt="plumbing" width="870" height="182">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Strip UI</dt>
<dd>
<p>This stage removes any attributes in the query that are namespaced to <code>ui</code>. For example, <code>:ui/checked</code>. This
allows you to place attributes on a UI component that use the app database for storage (and then query for them) while
still being able to easily use that component&#8217;s query as part of a server query.</p>
</dd>
<dt class="hdlist1">Queue</dt>
<dd>
<p>All queries are placed on a queue, and are processed one-at-a-time. There is an option to do queries in parallel and
bypass this queue.</p>
</dd>
<dt class="hdlist1">API</dt>
<dd>
<p>This is the server-side API you write to process the query.</p>
</dd>
<dt class="hdlist1">Mark missing/Merge</dt>
<dd>
<p>This is the first stage of the client response processing. During this phase the query and response are walked. If
the response does not contain a value for an attribute that was in the query, then a special <code>not-found</code> value is
added to the incoming response. This composite value is then deep merged with the application state. This forces
anything that has "disappeared" from the server to be marked as <code>not-found</code> in the app database.</p>
</dd>
<dt class="hdlist1">Sweep</dt>
<dd>
<p>This post-processing stage walks the app database and removes anything that has a value of <code>not-found</code>. This is the
second half of the mark/sweep of data that has disappeared from the server.</p>
</dd>
<dt class="hdlist1">Remap</dt>
<dd>
<p>If the request was a mutation (instead of a query), then the response may contain tempid remaps. This step walks the
app database replacing IDs that have been remapped.</p>
</dd>
<dt class="hdlist1">Post Mutation</dt>
<dd>
<p>The client API for network queries allows for a user-defined post mutation to run at the end of the chain. This is
used to create or update alternate UI views of the recently loaded data, if necessary.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_server_queries">Implementing server queries</h3>
<div class="paragraph">
<p>The server-side queries come in a the full EDN send from the client. The Untangled Server code automatically decodes
this query and passes it to an Om parser that you define. The basics of processing these queries are covered in the
<a href="https://github.com/untangled-web/untangled-tutorial">tutorial</a>.</p>
</div>
<div class="paragraph">
<p>The primary thing to remember is that server query processing functions (which run inside of a parser)
should return a map whose only key is <code>:value</code> and whose value is the value for that query attribute/fragment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_initial_data_loading">Initial Data Loading</h3>
<div class="paragraph">
<p>Initial data loading can be done in the client by adding a <code>started-callback</code> parameter to the construction of the
client. One or more calls to <code>load-data</code> can be used to queue up initial reads from your server, and each of those
loads can specify <code>:parallel true</code> to indicate that the loads are not order dependent (if that is indeed true).</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_demand_loading">On-demand Loading</h3>
<div class="paragraph">
<p>Any event (timeout, user interaction, etc) can be used to trigger additional loads. The typical calls used for this
are <code>load-data</code> and <code>load-field</code>. The former is completely general and allows for an arbitrary query. The latter is
component-centric, and can be used to auto-construct a server query based on the component&#8217;s ident, fields, and subqueries.</p>
</div>
<div class="paragraph">
<p>There are a number of examples in the
<a href="https://github.com/untangled-web/untangled-cookbook">Untangled Cookbook</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_server_mutations">Implementing server mutations</h3>
<div class="paragraph">
<p>Server mutations are coded exactly like client mutations, but their body does whatever server-side operations you care
to do (instead of mutating a client-focused UI database).</p>
</div>
<div class="paragraph">
<p>There are a few things to understand when implementing a mutation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must return a map whose main key is <code>:action</code> and whose value is a function that will accomplish the change</p>
</li>
<li>
<p>The function should return a map. If any data came into the mutation from the client as a temporary ID, then
the map should contain the key <code>:tempids</code> whose value is a map from the incoming tempid to the newly assigned
permanent ID.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_server_reads_after_mutation">Server reads (after mutation)</h3>
<div class="paragraph">
<p>You may add a server read to a transaction that also contains a mutation. In this case the mutations and reads will be split,
the mutations will run, then the reads will run (ordered using the network queue). Server reads take the form of an
<code>untangled/load</code> built-in client mutation. See the getting started video about
<a href="https://youtu.be/t49JYB27fv8?list=PLVi9lDx-4C_T_gsmBQ_2gztvk6h_Usw6R&amp;t=1535">server basics at roughly 25:20</a></p>
</div>
<div class="sect3">
<h4 id="_loading_markers">Loading markers</h4>
<div class="paragraph">
<p>When an item reaches the tip of networking queue and is pulled off Untangled will replace (unless told not to) the data
being loaded with a marker that the UI can use to show an alternate representation (e.g. a spinner in place of a table). There
is also a global loading marker at the top of the application state.</p>
</div>
<div class="paragraph">
<p>Loading markers are covered in this <a href="https://youtu.be/t49JYB27fv8">getting started video</a>
and the <a href="https://github.com/untangled-web/untangled-cookbook">Untangled Cookbook</a> recipe about lazy loading visual
indicators.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_out_of_band_data_websocket_timeout_xhr">Out-of-band Data (websocket, timeout, XHR)</h3>
<div class="paragraph">
<p>When using things like websocket server push, timeouts, and manual XHR requests you may have data that you&#8217;d like to
place in your application&#8217;s state that does not arrive through the normal Untangled processing pipeline. In these cases
you may use Om&#8217;s <code>merge!</code> function or Untangled&#8217;s <code>merge-state!</code>. The latter does a bit of common work for you if you
can structure the data in a way that looks like the response to an existing query of a UI component with an ident.</p>
</div>
<div class="paragraph">
<p>Basically, you structure the data to be a tree of maps that could exist in the database for a given component (and
children). The <code>merge-state!</code> function will extract the ident from that data, normalize the tree into objects, and
merge everything into tables.</p>
</div>
<div class="paragraph">
<p>Any number of named parameters can be given at the same time to add that object&#8217;s ident to other locations in the
database.</p>
</div>
<div class="paragraph">
<p>See the docstring of <code>merge-state!</code> and <code>integrate-ident!</code> in the <code>untangled.client.core</code> namespace.</p>
</div>
</div>
<div class="sect2">
<h3 id="_handling_network_errors">Handling network errors</h3>
<div class="paragraph">
<p>There are several different kinds of errors that can happen when working with a full-stack application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hard network errors (e.g. lost WiFi, server crashed)</p>
</li>
<li>
<p>Unexpected server errors (code threw an unexpected exception)</p>
</li>
<li>
<p>API errors (client made a bad request, server state is out of sync with client, etc.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Untangled gives you a few mechanisms for dealing with full-stack errors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A global handler that can be set when you create a client (see <code>:network-error-callback</code> in <code>new-untangled-client</code>). This
is only available if you use the default network implementation. This function will also be called on server
exceptions, since the default server implementation sends back a hard error.</p>
</li>
<li>
<p>Fallbacks: A fallback is a placeholder in mutations that is called if the mutation transaction fails. It can modify
the app state in any way it sees fit to represent the handling of the error (e.g. change UI state to show an error
dialog, reload the page, etc.).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_untangled_spec">Untangled Spec</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Untangled Spec is built on Clojure/Clojurescript test. The entire API of those libraries works within the body of the
specification. Untangled spec adds in a few useful features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A DSL that reads more like an outline of a runnable specification</p>
</li>
<li>
<p>Clojure and Clojurescript test runners that render the specification results as an outline</p>
</li>
<li>
<p>Easy mocking with script-like semantics, argument capture and verification, and async timeline simulation</p>
</li>
<li>
<p>Midje-like assertion blocks</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_specification_layout">Specification Layout</h3>

</div>
<div class="sect2">
<h3 id="_assertions_and_arrows">Assertions and arrows</h3>

</div>
<div class="sect2">
<h3 id="_mocking">Mocking</h3>
<div class="ulist">
<ul>
<li>
<p>Verify is automatic (use =2x&#8658; to indicate an exact number of runs, where 2 can be any number)</p>
</li>
<li>
<p>Left hand side is capture, right hand side can have assertions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Mention gotchas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cannot mock inline or macros</p>
</li>
<li>
<p>Mocking internals of Om can cause the browser-based spec renderer to fail. Recommend not doing it.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_untangled_datomic">Untangled Datomic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Untangled Datomic library includes a few useful additions that make it easier to integrate one or more Datomic
databases as persistent storage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A configurable database component</p>
</li>
<li>
<p>Schema and migration support</p>
</li>
<li>
<p>Experimental schema rule enforcement for additional referential integrity checks</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_injecting_and_configuring_database_s">Injecting and configuring database(s)</h3>

</div>
<div class="sect2">
<h3 id="_schema_support">Schema support</h3>
<div class="paragraph">
<p>The schema support in Untangled Datomic is a fork of Yuppiechef&#8217;s Datomic Schema with additions for experimental additional
schema enforcements.</p>
</div>
</div>
<div class="sect2">
<h3 id="_migrations">Migrations</h3>

</div>
<div class="sect2">
<h3 id="_validated_transactions_experimental">Validated transactions (EXPERIMENTAL)</h3>
<div class="paragraph">
<p>The library comes with a function called <code>vtransact</code>. It works just like Datomic&#8217;s <code>transact</code>, but enforces the additional
schema constraints. This function should be considered experimental. We&#8217;d be interested in feedback.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_websockets">Websockets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Untangled Websockets library gives you an alternate network implementation (for client and server) that maintains
a persistent TCP connection and enables server push. Note that the server continues to support the non-websocket API
endpoint, which is useful if you want to have multiple client types supported by the same server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internationalization">Internationalization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Untangled client comes with tools to enable full internationalization based on GNU gettext. The main features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use your native language (e.g. English) as the real strings in the UI. These will also act as the default values
should a translation be missing</p>
</li>
<li>
<p>Support for date, time, numeric, and plural formatting.</p>
</li>
<li>
<p>Support for splitting compiled translations into dynamically loadable modules.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-07-09 20:43:45 PDT
</div>
</div>
</body>
</html>